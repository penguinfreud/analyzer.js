<!DOCTYPE html>
<html>
<head>
<title>analyzer.js</title>
<script src="base.js"></script>
<script src="ident.js"></script>
<script src="analyzer2.js"></script>
<script src="parser2.js"></script>
<script src="compiler.js"></script>
<script>
var parserTests = [
"x = a + 1 * 3 - x;",
"foo: while (a) break foo;",
"if (b? c: d) { x += 1; o = { a: 2 } }",
"foo: bar: a;",
"2.34 + new a / ++x",
"function foo() { return \"abc\\r\\n\"; }",
"x = 1; while (x) { if (y) { x = x + 1; continue; } else { x = 2; break; } }"
],
parserResults,
cfgResults;

var testParser = function () {
    parserResults = parserTests.map(Parse);
};

var testCfg = function () {
    if (!parserResults) {
        testParser();
    }
    cfgResults = parserResults.map(CFG);
};

var displayCFG = function (func) {
    console.log(func.name || "[anon]");
    displayBlock(func.entry, 0, {});
    console.log("\n");
    var funcs = func.funcs, i;
    for (i = 0; i<funcs.length; i++) {
        displayCFG(funcs[i]);
    }
};

var displayBlock = function (block, id, visited) {
    var myId = block.id;
    if (!visited[myId]) {
        visited[myId] = 1;
        console.log(myId,
            "dom: " + block.dominator,
            "postdom: " + block.postDominator);
        var succ = block.succ, i, s;
        for (i = 0; i<succ.length; i++) {
            s = succ[i];
            console.log("\t", myId, " => ", s.id);
            displayBlock(s, myId, visited);
        }
    }
};

var testPredicate = function () {
    var x = new Var(), y = new Var(), z = new Var();
    var o = {};
    console.log(Match([x, 1, x], [z, y, 2], o));
    var o2 = {};
    o2[x.id] = y;
    o2[y.id] = z;
    o2[z.id] = 6;
    console.log(Subst([3, x], o2));
};

var testPredicate2 = function () {
    ast = Parse(parserTests[6]);
    program = CFG(ast);
    Analyze(program);
};

var testCompiler = function () {
    CFG(Parse(parserTests[6]));
    computeDominators(program);
    Analyze(program);
    Compile(program);
};

var search = function (a, h) {
    var l = 0, u = a.length, i, v;
    while (l < u) {
        i = (l + u) >> 1;
        if (a[i] <= h) {
            l = i + 1;
        } else {
            u = i;
        }
    }
    return l;
};
</script>
</head>
<body>
</body>
</html>
